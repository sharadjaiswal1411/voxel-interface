{"ast":null,"code":"import _regeneratorRuntime from \"/Applications/XAMPP/voxel-interface/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _objectSpread from \"/Applications/XAMPP/voxel-interface/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _asyncToGenerator from \"/Applications/XAMPP/voxel-interface/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n\nvar _s = $RefreshSig$();\n\nimport { captureException } from '@sentry/react';\nimport { useCallback } from 'react';\nimport { useActiveWeb3React } from 'hooks/index';\nimport { calculateGasMargin } from 'utils';\nexport default function useSendTransactionCallback() {\n  _s();\n\n  var _useActiveWeb3React = useActiveWeb3React(),\n      account = _useActiveWeb3React.account,\n      library = _useActiveWeb3React.library;\n\n  return useCallback( /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(contractAddress, encodedData, value, handler) {\n      var estimateGasOption, gasEstimate, e, tmp, tag, sendTransactionOption, _response, _e, _tmp, _tag;\n\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!(!account || !library)) {\n                _context.next = 2;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 2:\n              estimateGasOption = {\n                from: account,\n                to: contractAddress,\n                data: encodedData,\n                value: value\n              };\n              _context.prev = 3;\n              _context.next = 6;\n              return library.getSigner().estimateGas(estimateGasOption);\n\n            case 6:\n              gasEstimate = _context.sent;\n              _context.next = 17;\n              break;\n\n            case 9:\n              _context.prev = 9;\n              _context.t0 = _context[\"catch\"](3);\n              e = new Error('Swap failed', {\n                cause: _context.t0\n              });\n              e.name = 'SwapError';\n              tmp = JSON.stringify(_context.t0);\n              tag = tmp.includes('minTotalAmountOut') ? 'minTotalAmountOut' : tmp.includes('ERR_LIMIT_OUT') ? 'ERR_LIMIT_OUT' : tmp.toLowerCase().includes('1inch') ? 'call1InchFailed' : 'other';\n              captureException(e, {\n                level: 'fatal',\n                extra: estimateGasOption,\n                tags: {\n                  type: tag\n                }\n              });\n              throw new Error('gasEstimate not found: Unexpected error. Please contact support: none of the calls threw an error');\n\n            case 17:\n              sendTransactionOption = _objectSpread({\n                from: account,\n                to: contractAddress,\n                data: encodedData,\n                gasLimit: calculateGasMargin(gasEstimate)\n              }, value.eq('0') ? {} : {\n                value: value\n              });\n              _context.prev = 18;\n              _context.next = 21;\n              return library.getSigner().sendTransaction(sendTransactionOption);\n\n            case 21:\n              _response = _context.sent;\n              handler && handler(_response);\n              return _context.abrupt(\"return\", _response.hash);\n\n            case 26:\n              _context.prev = 26;\n              _context.t1 = _context[\"catch\"](18);\n\n              if (!((_context.t1 === null || _context.t1 === void 0 ? void 0 : _context.t1.code) === 4001)) {\n                _context.next = 32;\n                break;\n              }\n\n              throw new Error('Transaction rejected.');\n\n            case 32:\n              _e = new Error('Swap failed', {\n                cause: _context.t1\n              });\n              _e.name = 'SwapError';\n              _tmp = JSON.stringify(_context.t1);\n              _tag = _tmp.includes('minTotalAmountOut') ? 'minTotalAmountOut' : _tmp.includes('ERR_LIMIT_OUT') ? 'ERR_LIMIT_OUT' : _tmp.toLowerCase().includes('1inch') ? 'call1InchFailed' : 'other';\n              captureException(_e, {\n                level: 'error',\n                extra: sendTransactionOption,\n                tags: {\n                  type: _tag\n                }\n              }); // Otherwise, the error was unexpected, and we need to convey that.\n\n              throw new Error(_context.t1);\n\n            case 38:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[3, 9], [18, 26]]);\n    }));\n\n    return function (_x, _x2, _x3, _x4) {\n      return _ref.apply(this, arguments);\n    };\n  }(), [account, library]);\n}\n\n_s(useSendTransactionCallback, \"kjd3jFMY11Xo6xtVTx0rjcuweLA=\", false, function () {\n  return [useActiveWeb3React];\n});","map":{"version":3,"names":["captureException","useCallback","useActiveWeb3React","calculateGasMargin","useSendTransactionCallback","account","library","contractAddress","encodedData","value","handler","estimateGasOption","from","to","data","getSigner","estimateGas","gasEstimate","e","Error","cause","name","tmp","JSON","stringify","tag","includes","toLowerCase","level","extra","tags","type","sendTransactionOption","gasLimit","eq","sendTransaction","response","hash","code"],"sources":["/Applications/XAMPP/voxel-interface/src/hooks/useSendTransactionCallback.ts"],"sourcesContent":["import { BigNumber } from '@ethersproject/bignumber'\nimport { TransactionResponse } from '@ethersproject/providers'\nimport { captureException } from '@sentry/react'\nimport { ethers } from 'ethers'\nimport { useCallback } from 'react'\n\nimport { useActiveWeb3React } from 'hooks/index'\nimport { calculateGasMargin } from 'utils'\n\nexport default function useSendTransactionCallback() {\n  const { account, library } = useActiveWeb3React()\n\n  return useCallback(\n    async (\n      contractAddress: string,\n      encodedData: string,\n      value: BigNumber,\n      handler?: (response: TransactionResponse) => void,\n    ): Promise<string | undefined> => {\n      if (!account || !library) return\n\n      const estimateGasOption = {\n        from: account,\n        to: contractAddress,\n        data: encodedData,\n        value,\n      }\n\n      let gasEstimate: ethers.BigNumber | undefined\n      try {\n        gasEstimate = await library.getSigner().estimateGas(estimateGasOption)\n      } catch (error) {\n        const e = new Error('Swap failed', { cause: error })\n        e.name = 'SwapError'\n\n        const tmp = JSON.stringify(error)\n        const tag = tmp.includes('minTotalAmountOut')\n          ? 'minTotalAmountOut'\n          : tmp.includes('ERR_LIMIT_OUT')\n          ? 'ERR_LIMIT_OUT'\n          : tmp.toLowerCase().includes('1inch')\n          ? 'call1InchFailed'\n          : 'other'\n\n        captureException(e, {\n          level: 'fatal',\n          extra: estimateGasOption,\n          tags: {\n            type: tag,\n          },\n        })\n\n        throw new Error(\n          'gasEstimate not found: Unexpected error. Please contact support: none of the calls threw an error',\n        )\n      }\n\n      const sendTransactionOption = {\n        from: account,\n        to: contractAddress,\n        data: encodedData,\n        gasLimit: calculateGasMargin(gasEstimate),\n        ...(value.eq('0') ? {} : { value }),\n      }\n\n      try {\n        const response = await library.getSigner().sendTransaction(sendTransactionOption)\n        handler && handler(response)\n        return response.hash\n      } catch (error) {\n        // if the user rejected the tx, pass this along\n        if (error?.code === 4001) {\n          throw new Error('Transaction rejected.')\n        } else {\n          const e = new Error('Swap failed', { cause: error })\n          e.name = 'SwapError'\n\n          const tmp = JSON.stringify(error)\n          const tag = tmp.includes('minTotalAmountOut')\n            ? 'minTotalAmountOut'\n            : tmp.includes('ERR_LIMIT_OUT')\n            ? 'ERR_LIMIT_OUT'\n            : tmp.toLowerCase().includes('1inch')\n            ? 'call1InchFailed'\n            : 'other'\n\n          captureException(e, {\n            level: 'error',\n            extra: sendTransactionOption,\n            tags: {\n              type: tag,\n            },\n          })\n\n          // Otherwise, the error was unexpected, and we need to convey that.\n          throw new Error(error)\n        }\n      }\n    },\n    [account, library],\n  )\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}