{"ast":null,"code":"import _regeneratorRuntime from \"/Applications/XAMPP/voxel-interface/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Applications/XAMPP/voxel-interface/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _slicedToArray from \"/Applications/XAMPP/voxel-interface/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\n\nvar _s = $RefreshSig$();\n\nimport { useState } from 'react';\nimport { useLocalStorage } from 'react-use';\nimport useMixpanel, { MIXPANEL_TYPE } from 'hooks/useMixpanel';\nimport { checkChrome } from 'utils/checkChrome';\nimport { fetchToken } from 'utils/firebase';\n\nvar useNotification = function useNotification() {\n  _s();\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      isLoading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var _useLocalStorage = useLocalStorage('true-sight-subscribe', false),\n      _useLocalStorage2 = _slicedToArray(_useLocalStorage, 2),\n      hasSubscribed = _useLocalStorage2[0],\n      setHasSubscribed = _useLocalStorage2[1];\n\n  var isChrome = checkChrome();\n\n  var _useMixpanel = useMixpanel(),\n      mixpanelHandler = _useMixpanel.mixpanelHandler;\n\n  var handleSubscribe = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n      var token, payload, response;\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              mixpanelHandler(MIXPANEL_TYPE.DISCOVER_CLICK_SUBSCRIBE_TRENDING_SOON);\n\n              if (!(!isChrome || isLoading)) {\n                _context.next = 3;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 3:\n              _context.next = 5;\n              return fetchToken();\n\n            case 5:\n              token = _context.sent;\n\n              if (token) {\n                _context.next = 8;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 8:\n              setLoading(true);\n              _context.prev = 9;\n              payload = {\n                users: [{\n                  type: isChrome && 'FCM_TOKEN',\n                  receivingAddress: token\n                }]\n              };\n              _context.next = 13;\n              return fetch(\"\".concat(process.env.REACT_APP_NOTIFICATION_API, \"/v1/topics/1/subscribe\"), {\n                method: 'POST',\n                headers: {\n                  'content-type': 'application/json',\n                  accept: 'application/json'\n                },\n                body: JSON.stringify(payload)\n              });\n\n            case 13:\n              response = _context.sent;\n\n              if (response.status === 200) {\n                mixpanelHandler(MIXPANEL_TYPE.DISCOVER_SUBSCRIBE_TRENDING_SOON_SUCCESS);\n                setHasSubscribed(true);\n              }\n\n              _context.next = 20;\n              break;\n\n            case 17:\n              _context.prev = 17;\n              _context.t0 = _context[\"catch\"](9);\n              console.error('Something went wrong while subscribing', _context.t0);\n\n            case 20:\n              _context.prev = 20;\n              setLoading(false);\n              return _context.finish(20);\n\n            case 23:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[9, 17, 20, 23]]);\n    }));\n\n    return function handleSubscribe() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var handleUnsubscribe = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n      var token, payload, response;\n      return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              mixpanelHandler(MIXPANEL_TYPE.DISCOVER_CLICK_UNSUBSCRIBE_TRENDING_SOON);\n\n              if (!isLoading) {\n                _context2.next = 3;\n                break;\n              }\n\n              return _context2.abrupt(\"return\");\n\n            case 3:\n              _context2.next = 5;\n              return fetchToken();\n\n            case 5:\n              token = _context2.sent;\n\n              if (token) {\n                _context2.next = 8;\n                break;\n              }\n\n              return _context2.abrupt(\"return\");\n\n            case 8:\n              setLoading(true);\n              _context2.prev = 9;\n              payload = {\n                users: [{\n                  type: isChrome && 'FCM_TOKEN',\n                  receivingAddress: token\n                }]\n              };\n              _context2.next = 13;\n              return fetch(\"\".concat(process.env.REACT_APP_NOTIFICATION_API, \"/v1/topics/1/unsubscribe\"), {\n                method: 'DELETE',\n                headers: {\n                  'content-type': 'application/json',\n                  accept: 'application/json'\n                },\n                body: JSON.stringify(payload)\n              });\n\n            case 13:\n              response = _context2.sent;\n\n              if (response.status === 200) {\n                mixpanelHandler(MIXPANEL_TYPE.DISCOVER_UNSUBSCRIBE_TRENDING_SOON_SUCCESS);\n                setHasSubscribed(false);\n              }\n\n              _context2.next = 20;\n              break;\n\n            case 17:\n              _context2.prev = 17;\n              _context2.t0 = _context2[\"catch\"](9);\n              console.error('Something went wrong while unsubscribing', _context2.t0);\n\n            case 20:\n              _context2.prev = 20;\n              setLoading(false);\n              return _context2.finish(20);\n\n            case 23:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[9, 17, 20, 23]]);\n    }));\n\n    return function handleUnsubscribe() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  return {\n    isLoading: isLoading,\n    isChrome: isChrome,\n    hasSubscribed: hasSubscribed,\n    handleSubscribe: handleSubscribe,\n    handleUnsubscribe: handleUnsubscribe\n  };\n};\n\n_s(useNotification, \"QeHlI+rsCLlLvjSM4jBZ8n3L/6w=\", false, function () {\n  return [useLocalStorage, useMixpanel];\n});\n\nexport default useNotification;","map":{"version":3,"names":["useState","useLocalStorage","useMixpanel","MIXPANEL_TYPE","checkChrome","fetchToken","useNotification","isLoading","setLoading","hasSubscribed","setHasSubscribed","isChrome","mixpanelHandler","handleSubscribe","DISCOVER_CLICK_SUBSCRIBE_TRENDING_SOON","token","payload","users","type","receivingAddress","fetch","process","env","REACT_APP_NOTIFICATION_API","method","headers","accept","body","JSON","stringify","response","status","DISCOVER_SUBSCRIBE_TRENDING_SOON_SUCCESS","console","error","handleUnsubscribe","DISCOVER_CLICK_UNSUBSCRIBE_TRENDING_SOON","DISCOVER_UNSUBSCRIBE_TRENDING_SOON_SUCCESS"],"sources":["/Applications/XAMPP/voxel-interface/src/pages/TrueSight/hooks/useNotification.ts"],"sourcesContent":["import { useState } from 'react'\nimport { useLocalStorage } from 'react-use'\n\nimport useMixpanel, { MIXPANEL_TYPE } from 'hooks/useMixpanel'\nimport { checkChrome } from 'utils/checkChrome'\nimport { fetchToken } from 'utils/firebase'\n\nconst useNotification = () => {\n  const [isLoading, setLoading] = useState(false)\n  const [hasSubscribed, setHasSubscribed] = useLocalStorage('true-sight-subscribe', false)\n  const isChrome = checkChrome()\n  const { mixpanelHandler } = useMixpanel()\n\n  const handleSubscribe = async () => {\n    mixpanelHandler(MIXPANEL_TYPE.DISCOVER_CLICK_SUBSCRIBE_TRENDING_SOON)\n\n    if (!isChrome || isLoading) {\n      return\n    }\n\n    const token = await fetchToken()\n    // TODO: implement for Safari\n    if (!token) {\n      return\n    }\n\n    setLoading(true)\n\n    try {\n      const payload = { users: [{ type: isChrome && 'FCM_TOKEN', receivingAddress: token }] }\n      const response = await fetch(`${process.env.REACT_APP_NOTIFICATION_API}/v1/topics/1/subscribe`, {\n        method: 'POST',\n        headers: { 'content-type': 'application/json', accept: 'application/json' },\n        body: JSON.stringify(payload),\n      })\n\n      if (response.status === 200) {\n        mixpanelHandler(MIXPANEL_TYPE.DISCOVER_SUBSCRIBE_TRENDING_SOON_SUCCESS)\n        setHasSubscribed(true)\n      }\n    } catch (e) {\n      console.error('Something went wrong while subscribing', e)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleUnsubscribe = async () => {\n    mixpanelHandler(MIXPANEL_TYPE.DISCOVER_CLICK_UNSUBSCRIBE_TRENDING_SOON)\n\n    if (isLoading) {\n      return\n    }\n\n    const token = await fetchToken()\n    if (!token) {\n      return\n    }\n\n    setLoading(true)\n\n    try {\n      const payload = { users: [{ type: isChrome && 'FCM_TOKEN', receivingAddress: token }] }\n      const response = await fetch(`${process.env.REACT_APP_NOTIFICATION_API}/v1/topics/1/unsubscribe`, {\n        method: 'DELETE',\n        headers: { 'content-type': 'application/json', accept: 'application/json' },\n        body: JSON.stringify(payload),\n      })\n\n      if (response.status === 200) {\n        mixpanelHandler(MIXPANEL_TYPE.DISCOVER_UNSUBSCRIBE_TRENDING_SOON_SUCCESS)\n        setHasSubscribed(false)\n      }\n    } catch (e) {\n      console.error('Something went wrong while unsubscribing', e)\n    } finally {\n      setLoading(false)\n    }\n  }\n  return { isLoading, isChrome, hasSubscribed, handleSubscribe, handleUnsubscribe }\n}\n\nexport default useNotification\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}