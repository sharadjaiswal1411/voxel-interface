{"ast":null,"code":"import _slicedToArray from \"/Applications/XAMPP/voxel-interface/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\n\nvar _s = $RefreshSig$();\n\nimport { useCallback, useEffect, useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { useActiveWeb3React } from '../../hooks';\nimport useDebounce from '../../hooks/useDebounce';\nimport useIsWindowVisible from '../../hooks/useIsWindowVisible';\nimport { updateBlockNumber } from './actions';\nexport default function Updater() {\n  _s();\n\n  var _useActiveWeb3React = useActiveWeb3React(),\n      library = _useActiveWeb3React.library,\n      chainId = _useActiveWeb3React.chainId;\n\n  var dispatch = useDispatch();\n  var windowVisible = useIsWindowVisible();\n\n  var _useState = useState({\n    chainId: chainId,\n    blockNumber: null\n  }),\n      _useState2 = _slicedToArray(_useState, 2),\n      state = _useState2[0],\n      setState = _useState2[1];\n\n  var blockNumberCallback = useCallback(function (blockNumber) {\n    setState(function (state) {\n      if (chainId === state.chainId) {\n        if (typeof state.blockNumber !== 'number') return {\n          chainId: chainId,\n          blockNumber: blockNumber\n        };\n        return {\n          chainId: chainId,\n          blockNumber: Math.max(blockNumber, state.blockNumber)\n        };\n      }\n\n      return state;\n    });\n  }, [chainId, setState]); // attach/detach listeners\n\n  useEffect(function () {\n    if (!library || !chainId || !windowVisible) return undefined;\n    setState({\n      chainId: chainId,\n      blockNumber: null\n    });\n    library.getBlockNumber().then(blockNumberCallback).catch(function (error) {\n      return console.error(\"Failed to get block number for chainId: \".concat(chainId), error);\n    });\n    library.on('block', blockNumberCallback);\n    return function () {\n      library.removeListener('block', blockNumberCallback);\n    };\n  }, [dispatch, chainId, library, blockNumberCallback, windowVisible]);\n  var debouncedState = useDebounce(state, 100);\n  useEffect(function () {\n    if (!debouncedState.chainId || !debouncedState.blockNumber || !windowVisible) return;\n    dispatch(updateBlockNumber({\n      chainId: debouncedState.chainId,\n      blockNumber: debouncedState.blockNumber\n    }));\n  }, [windowVisible, dispatch, debouncedState.blockNumber, debouncedState.chainId]);\n  return null;\n}\n\n_s(Updater, \"YodeNKw159DNGvMWLk5W7jeVjRc=\", false, function () {\n  return [useActiveWeb3React, useDispatch, useIsWindowVisible, useDebounce];\n});\n\n_c = Updater;\n\nvar _c;\n\n$RefreshReg$(_c, \"Updater\");","map":{"version":3,"names":["useCallback","useEffect","useState","useDispatch","useActiveWeb3React","useDebounce","useIsWindowVisible","updateBlockNumber","Updater","library","chainId","dispatch","windowVisible","blockNumber","state","setState","blockNumberCallback","Math","max","undefined","getBlockNumber","then","catch","error","console","on","removeListener","debouncedState"],"sources":["/Applications/XAMPP/voxel-interface/src/state/application/updater.ts"],"sourcesContent":["import { useCallback, useEffect, useState } from 'react'\nimport { useDispatch } from 'react-redux'\n\nimport { useActiveWeb3React } from '../../hooks'\nimport useDebounce from '../../hooks/useDebounce'\nimport useIsWindowVisible from '../../hooks/useIsWindowVisible'\nimport { updateBlockNumber } from './actions'\n\nexport default function Updater(): null {\n  const { library, chainId } = useActiveWeb3React()\n  const dispatch = useDispatch()\n\n  const windowVisible = useIsWindowVisible()\n\n  const [state, setState] = useState<{ chainId: number | undefined; blockNumber: number | null }>({\n    chainId,\n    blockNumber: null,\n  })\n\n  const blockNumberCallback = useCallback(\n    (blockNumber: number) => {\n      setState(state => {\n        if (chainId === state.chainId) {\n          if (typeof state.blockNumber !== 'number') return { chainId, blockNumber }\n          return { chainId, blockNumber: Math.max(blockNumber, state.blockNumber) }\n        }\n        return state\n      })\n    },\n    [chainId, setState],\n  )\n\n  // attach/detach listeners\n  useEffect(() => {\n    if (!library || !chainId || !windowVisible) return undefined\n\n    setState({ chainId, blockNumber: null })\n\n    library\n      .getBlockNumber()\n      .then(blockNumberCallback)\n      .catch(error => console.error(`Failed to get block number for chainId: ${chainId}`, error))\n\n    library.on('block', blockNumberCallback)\n    return () => {\n      library.removeListener('block', blockNumberCallback)\n    }\n  }, [dispatch, chainId, library, blockNumberCallback, windowVisible])\n\n  const debouncedState = useDebounce(state, 100)\n\n  useEffect(() => {\n    if (!debouncedState.chainId || !debouncedState.blockNumber || !windowVisible) return\n    dispatch(updateBlockNumber({ chainId: debouncedState.chainId, blockNumber: debouncedState.blockNumber }))\n  }, [windowVisible, dispatch, debouncedState.blockNumber, debouncedState.chainId])\n\n  return null\n}\n"],"mappings":";;;;AAAA,SAASA,WAAT,EAAsBC,SAAtB,EAAiCC,QAAjC,QAAiD,OAAjD;AACA,SAASC,WAAT,QAA4B,aAA5B;AAEA,SAASC,kBAAT,QAAmC,aAAnC;AACA,OAAOC,WAAP,MAAwB,yBAAxB;AACA,OAAOC,kBAAP,MAA+B,gCAA/B;AACA,SAASC,iBAAT,QAAkC,WAAlC;AAEA,eAAe,SAASC,OAAT,GAAyB;EAAA;;EACtC,0BAA6BJ,kBAAkB,EAA/C;EAAA,IAAQK,OAAR,uBAAQA,OAAR;EAAA,IAAiBC,OAAjB,uBAAiBA,OAAjB;;EACA,IAAMC,QAAQ,GAAGR,WAAW,EAA5B;EAEA,IAAMS,aAAa,GAAGN,kBAAkB,EAAxC;;EAEA,gBAA0BJ,QAAQ,CAA8D;IAC9FQ,OAAO,EAAPA,OAD8F;IAE9FG,WAAW,EAAE;EAFiF,CAA9D,CAAlC;EAAA;EAAA,IAAOC,KAAP;EAAA,IAAcC,QAAd;;EAKA,IAAMC,mBAAmB,GAAGhB,WAAW,CACrC,UAACa,WAAD,EAAyB;IACvBE,QAAQ,CAAC,UAAAD,KAAK,EAAI;MAChB,IAAIJ,OAAO,KAAKI,KAAK,CAACJ,OAAtB,EAA+B;QAC7B,IAAI,OAAOI,KAAK,CAACD,WAAb,KAA6B,QAAjC,EAA2C,OAAO;UAAEH,OAAO,EAAPA,OAAF;UAAWG,WAAW,EAAXA;QAAX,CAAP;QAC3C,OAAO;UAAEH,OAAO,EAAPA,OAAF;UAAWG,WAAW,EAAEI,IAAI,CAACC,GAAL,CAASL,WAAT,EAAsBC,KAAK,CAACD,WAA5B;QAAxB,CAAP;MACD;;MACD,OAAOC,KAAP;IACD,CANO,CAAR;EAOD,CAToC,EAUrC,CAACJ,OAAD,EAAUK,QAAV,CAVqC,CAAvC,CAXsC,CAwBtC;;EACAd,SAAS,CAAC,YAAM;IACd,IAAI,CAACQ,OAAD,IAAY,CAACC,OAAb,IAAwB,CAACE,aAA7B,EAA4C,OAAOO,SAAP;IAE5CJ,QAAQ,CAAC;MAAEL,OAAO,EAAPA,OAAF;MAAWG,WAAW,EAAE;IAAxB,CAAD,CAAR;IAEAJ,OAAO,CACJW,cADH,GAEGC,IAFH,CAEQL,mBAFR,EAGGM,KAHH,CAGS,UAAAC,KAAK;MAAA,OAAIC,OAAO,CAACD,KAAR,mDAAyDb,OAAzD,GAAoEa,KAApE,CAAJ;IAAA,CAHd;IAKAd,OAAO,CAACgB,EAAR,CAAW,OAAX,EAAoBT,mBAApB;IACA,OAAO,YAAM;MACXP,OAAO,CAACiB,cAAR,CAAuB,OAAvB,EAAgCV,mBAAhC;IACD,CAFD;EAGD,CAdQ,EAcN,CAACL,QAAD,EAAWD,OAAX,EAAoBD,OAApB,EAA6BO,mBAA7B,EAAkDJ,aAAlD,CAdM,CAAT;EAgBA,IAAMe,cAAc,GAAGtB,WAAW,CAACS,KAAD,EAAQ,GAAR,CAAlC;EAEAb,SAAS,CAAC,YAAM;IACd,IAAI,CAAC0B,cAAc,CAACjB,OAAhB,IAA2B,CAACiB,cAAc,CAACd,WAA3C,IAA0D,CAACD,aAA/D,EAA8E;IAC9ED,QAAQ,CAACJ,iBAAiB,CAAC;MAAEG,OAAO,EAAEiB,cAAc,CAACjB,OAA1B;MAAmCG,WAAW,EAAEc,cAAc,CAACd;IAA/D,CAAD,CAAlB,CAAR;EACD,CAHQ,EAGN,CAACD,aAAD,EAAgBD,QAAhB,EAA0BgB,cAAc,CAACd,WAAzC,EAAsDc,cAAc,CAACjB,OAArE,CAHM,CAAT;EAKA,OAAO,IAAP;AACD;;GAjDuBF,O;UACOJ,kB,EACZD,W,EAEKG,kB,EAqCCD,W;;;KAzCDG,O"},"metadata":{},"sourceType":"module"}