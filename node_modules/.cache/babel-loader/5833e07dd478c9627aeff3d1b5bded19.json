{"ast":null,"code":"var _s = $RefreshSig$(),\n    _s2 = $RefreshSig$(),\n    _s3 = $RefreshSig$();\n\nimport { useQuery } from '@apollo/client';\nimport { ChainId } from '@kyberswap/ks-sdk-core';\nimport { TICK_SPACINGS, tickToPrice } from '@kyberswap/ks-sdk-elastic';\nimport JSBI from 'jsbi';\nimport { useMemo } from 'react';\nimport { ALL_TICKS } from 'apollo/queries/promm';\nimport { NETWORKS_INFO } from 'constants/networks';\nimport { useActiveWeb3React } from 'hooks';\nimport computeSurroundingTicks from 'utils/computeSurroundingTicks';\nimport { PoolState, usePool } from './usePools';\nimport useProAmmPoolInfo from './useProAmmPoolInfo';\nvar PRICE_FIXED_DIGITS = 8; // Tick with fields parsed to JSBIs, and active liquidity computed.\n\nvar getActiveTick = function getActiveTick(tickCurrent, feeAmount) {\n  return tickCurrent !== undefined && feeAmount ? Math.floor(tickCurrent / TICK_SPACINGS[feeAmount]) * TICK_SPACINGS[feeAmount] : undefined;\n};\n\nvar useAllTicks = function useAllTicks(poolAddress) {\n  _s();\n\n  var _useActiveWeb3React = useActiveWeb3React(),\n      chainId = _useActiveWeb3React.chainId;\n\n  var client = NETWORKS_INFO[chainId || ChainId.MAINNET].elasticClient;\n  return useQuery(ALL_TICKS(poolAddress === null || poolAddress === void 0 ? void 0 : poolAddress.toLowerCase()), {\n    client: client,\n    pollInterval: 30000\n  });\n}; // Fetches all ticks for a given pool\n\n\n_s(useAllTicks, \"9f1xHM72gWEZj39qsfIU5i18xQQ=\", false, function () {\n  return [useActiveWeb3React, useQuery];\n});\n\nexport function useAllV3Ticks(currencyA, currencyB, feeAmount) {\n  _s2();\n\n  var poolAddress = useProAmmPoolInfo(currencyA === null || currencyA === void 0 ? void 0 : currencyA.wrapped, currencyB === null || currencyB === void 0 ? void 0 : currencyB.wrapped, feeAmount);\n\n  var _useAllTicks = useAllTicks(poolAddress),\n      isLoading = _useAllTicks.loading,\n      data = _useAllTicks.data,\n      error = _useAllTicks.error; // const { isLoading, isError, error, isUninitialized, data } = useAllV3TicksQuery(\n  //   poolAddress ? { poolAddress: poolAddress?.toLowerCase(), skip: 0 } : skipToken,\n  //   {\n  //     pollingInterval: ms`30s`,\n  //   },\n  // )\n\n\n  return {\n    isLoading: isLoading,\n    isUninitialized: false,\n    isError: !!error,\n    error: error,\n    ticks: data === null || data === void 0 ? void 0 : data.ticks\n  };\n}\n\n_s2(useAllV3Ticks, \"CWc6h4XxSPTu2v9/7wR+usVtesg=\", false, function () {\n  return [useProAmmPoolInfo, useAllTicks];\n});\n\nexport function usePoolActiveLiquidity(currencyA, currencyB, feeAmount) {\n  _s3();\n\n  var pool = usePool(currencyA, currencyB, feeAmount); // Find nearest valid tick for pool in case tick is not initialized.\n\n  var activeTick = useMemo(function () {\n    var _pool$;\n\n    return getActiveTick((_pool$ = pool[1]) === null || _pool$ === void 0 ? void 0 : _pool$.tickCurrent, feeAmount);\n  }, [pool, feeAmount]);\n\n  var _useAllV3Ticks = useAllV3Ticks(currencyA, currencyB, feeAmount),\n      isLoading = _useAllV3Ticks.isLoading,\n      isUninitialized = _useAllV3Ticks.isUninitialized,\n      isError = _useAllV3Ticks.isError,\n      error = _useAllV3Ticks.error,\n      ticks = _useAllV3Ticks.ticks;\n\n  return useMemo(function () {\n    var _pool$1$liquidity, _pool$2;\n\n    if (!currencyA || !currencyB || activeTick === undefined || pool[0] !== PoolState.EXISTS || !ticks || ticks.length === 0 || isLoading || isUninitialized) {\n      return {\n        isLoading: isLoading || pool[0] === PoolState.LOADING,\n        isUninitialized: isUninitialized,\n        isError: isError,\n        error: error,\n        activeTick: activeTick,\n        data: undefined\n      };\n    }\n\n    var token0 = currencyA === null || currencyA === void 0 ? void 0 : currencyA.wrapped;\n    var token1 = currencyB === null || currencyB === void 0 ? void 0 : currencyB.wrapped; // find where the active tick would be to partition the array\n    // if the active tick is initialized, the pivot will be an element\n    // if not, take the previous tick as pivot\n\n    var pivot = ticks.findIndex(function (_ref) {\n      var tickIdx = _ref.tickIdx;\n      return tickIdx > activeTick;\n    }) - 1;\n\n    if (pivot < 0) {\n      // consider setting a local error\n      console.error('TickData pivot not found');\n      return {\n        isLoading: isLoading,\n        isUninitialized: isUninitialized,\n        isError: isError,\n        error: error,\n        activeTick: activeTick,\n        data: undefined\n      };\n    }\n\n    var activeTickProcessed = {\n      liquidityActive: JSBI.BigInt((_pool$1$liquidity = (_pool$2 = pool[1]) === null || _pool$2 === void 0 ? void 0 : _pool$2.liquidity) !== null && _pool$1$liquidity !== void 0 ? _pool$1$liquidity : 0),\n      tickIdx: activeTick,\n      liquidityNet: Number(ticks[pivot].tickIdx) === activeTick ? JSBI.BigInt(ticks[pivot].liquidityNet) : JSBI.BigInt(0),\n      price0: tickToPrice(token0, token1, activeTick).toFixed(PRICE_FIXED_DIGITS)\n    };\n    var subsequentTicks = computeSurroundingTicks(token0, token1, activeTickProcessed, ticks, pivot, true);\n    var previousTicks = computeSurroundingTicks(token0, token1, activeTickProcessed, ticks, pivot, false);\n    var ticksProcessed = previousTicks.concat(activeTickProcessed).concat(subsequentTicks);\n    return {\n      isLoading: isLoading,\n      isUninitialized: isUninitialized,\n      isError: isError,\n      error: error,\n      activeTick: activeTick,\n      data: ticksProcessed\n    };\n  }, [currencyA, currencyB, activeTick, pool, ticks, isLoading, isUninitialized, isError, error]);\n}\n\n_s3(usePoolActiveLiquidity, \"+7Zt83lQFSwENJUzf0/oLeKJZok=\", false, function () {\n  return [usePool, useAllV3Ticks];\n});","map":{"version":3,"names":["useQuery","ChainId","TICK_SPACINGS","tickToPrice","JSBI","useMemo","ALL_TICKS","NETWORKS_INFO","useActiveWeb3React","computeSurroundingTicks","PoolState","usePool","useProAmmPoolInfo","PRICE_FIXED_DIGITS","getActiveTick","tickCurrent","feeAmount","undefined","Math","floor","useAllTicks","poolAddress","chainId","client","MAINNET","elasticClient","toLowerCase","pollInterval","useAllV3Ticks","currencyA","currencyB","wrapped","isLoading","loading","data","error","isUninitialized","isError","ticks","usePoolActiveLiquidity","pool","activeTick","EXISTS","length","LOADING","token0","token1","pivot","findIndex","tickIdx","console","activeTickProcessed","liquidityActive","BigInt","liquidity","liquidityNet","Number","price0","toFixed","subsequentTicks","previousTicks","ticksProcessed","concat"],"sources":["/Applications/XAMPP/voxel-interface/src/hooks/usePoolTickData.ts"],"sourcesContent":["import { useQuery } from '@apollo/client'\nimport { ChainId, Currency } from '@kyberswap/ks-sdk-core'\nimport { FeeAmount, TICK_SPACINGS, tickToPrice } from '@kyberswap/ks-sdk-elastic'\nimport JSBI from 'jsbi'\nimport ms from 'ms.macro'\nimport { useMemo } from 'react'\n\nimport { ALL_TICKS, Tick } from 'apollo/queries/promm'\nimport { NETWORKS_INFO } from 'constants/networks'\nimport { useActiveWeb3React } from 'hooks'\nimport computeSurroundingTicks from 'utils/computeSurroundingTicks'\n\nimport { PoolState, usePool } from './usePools'\nimport useProAmmPoolInfo from './useProAmmPoolInfo'\n\nconst PRICE_FIXED_DIGITS = 8\n\n// Tick with fields parsed to JSBIs, and active liquidity computed.\nexport interface TickProcessed {\n  tickIdx: number\n  liquidityActive: JSBI\n  liquidityNet: JSBI\n  price0: string\n}\n\nconst getActiveTick = (tickCurrent: number | undefined, feeAmount: FeeAmount | undefined) =>\n  tickCurrent !== undefined && feeAmount\n    ? Math.floor(tickCurrent / TICK_SPACINGS[feeAmount]) * TICK_SPACINGS[feeAmount]\n    : undefined\n\nconst useAllTicks = (poolAddress: string) => {\n  const { chainId } = useActiveWeb3React()\n  const client = NETWORKS_INFO[chainId || ChainId.MAINNET].elasticClient\n\n  return useQuery(ALL_TICKS(poolAddress?.toLowerCase()), {\n    client,\n    pollInterval: ms`30s`,\n  })\n}\n\n// Fetches all ticks for a given pool\nexport function useAllV3Ticks(\n  currencyA: Currency | undefined,\n  currencyB: Currency | undefined,\n  feeAmount: FeeAmount | undefined,\n) {\n  const poolAddress = useProAmmPoolInfo(currencyA?.wrapped, currencyB?.wrapped, feeAmount)\n\n  const { loading: isLoading, data, error } = useAllTicks(poolAddress)\n\n  // const { isLoading, isError, error, isUninitialized, data } = useAllV3TicksQuery(\n  //   poolAddress ? { poolAddress: poolAddress?.toLowerCase(), skip: 0 } : skipToken,\n  //   {\n  //     pollingInterval: ms`30s`,\n  //   },\n  // )\n\n  return {\n    isLoading,\n    isUninitialized: false,\n    isError: !!error,\n    error,\n    ticks: data?.ticks as Tick[],\n  }\n}\n\nexport function usePoolActiveLiquidity(\n  currencyA: Currency | undefined,\n  currencyB: Currency | undefined,\n  feeAmount: FeeAmount | undefined,\n): {\n  isLoading: boolean\n  isUninitialized: boolean\n  isError: boolean\n  error: any\n  activeTick: number | undefined\n  data: TickProcessed[] | undefined\n} {\n  const pool = usePool(currencyA, currencyB, feeAmount)\n\n  // Find nearest valid tick for pool in case tick is not initialized.\n  const activeTick = useMemo(() => getActiveTick(pool[1]?.tickCurrent, feeAmount), [pool, feeAmount])\n  const { isLoading, isUninitialized, isError, error, ticks } = useAllV3Ticks(currencyA, currencyB, feeAmount)\n\n  return useMemo(() => {\n    if (\n      !currencyA ||\n      !currencyB ||\n      activeTick === undefined ||\n      pool[0] !== PoolState.EXISTS ||\n      !ticks ||\n      ticks.length === 0 ||\n      isLoading ||\n      isUninitialized\n    ) {\n      return {\n        isLoading: isLoading || pool[0] === PoolState.LOADING,\n        isUninitialized,\n        isError,\n        error,\n        activeTick,\n        data: undefined,\n      }\n    }\n\n    const token0 = currencyA?.wrapped\n    const token1 = currencyB?.wrapped\n\n    // find where the active tick would be to partition the array\n    // if the active tick is initialized, the pivot will be an element\n    // if not, take the previous tick as pivot\n    const pivot = ticks.findIndex(({ tickIdx }) => tickIdx > activeTick) - 1\n\n    if (pivot < 0) {\n      // consider setting a local error\n      console.error('TickData pivot not found')\n      return {\n        isLoading,\n        isUninitialized,\n        isError,\n        error,\n        activeTick,\n        data: undefined,\n      }\n    }\n\n    const activeTickProcessed: TickProcessed = {\n      liquidityActive: JSBI.BigInt(pool[1]?.liquidity ?? 0),\n      tickIdx: activeTick,\n      liquidityNet:\n        Number(ticks[pivot].tickIdx) === activeTick ? JSBI.BigInt(ticks[pivot].liquidityNet) : JSBI.BigInt(0),\n      price0: tickToPrice(token0, token1, activeTick).toFixed(PRICE_FIXED_DIGITS),\n    }\n\n    const subsequentTicks = computeSurroundingTicks(token0, token1, activeTickProcessed, ticks, pivot, true)\n\n    const previousTicks = computeSurroundingTicks(token0, token1, activeTickProcessed, ticks, pivot, false)\n\n    const ticksProcessed = previousTicks.concat(activeTickProcessed).concat(subsequentTicks)\n\n    return {\n      isLoading,\n      isUninitialized,\n      isError,\n      error,\n      activeTick,\n      data: ticksProcessed,\n    }\n  }, [currencyA, currencyB, activeTick, pool, ticks, isLoading, isUninitialized, isError, error])\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}