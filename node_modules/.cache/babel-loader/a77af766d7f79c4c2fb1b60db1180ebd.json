{"ast":null,"code":"import _objectSpread from \"/Applications/XAMPP/voxel-interface/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _slicedToArray from \"/Applications/XAMPP/voxel-interface/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _defineProperty from \"/Applications/XAMPP/voxel-interface/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\n\nvar _s = $RefreshSig$();\n\nimport { FeeAmount } from '@kyberswap/ks-sdk-elastic';\nimport { useEffect, useMemo, useState } from 'react';\nimport { POOL_POSITION_COUNT } from 'apollo/queries/promm';\nimport { NETWORKS_INFO } from 'constants/networks';\nimport { useActiveWeb3React } from 'hooks';\nimport { useProAmmPoolInfos } from 'hooks/useProAmmPoolInfo';\nexport var useFeeTierDistribution = function useFeeTierDistribution(currencyA, currencyB) {\n  _s();\n\n  var _useActiveWeb3React = useActiveWeb3React(),\n      chainId = _useActiveWeb3React.chainId;\n\n  var feeAmounts = useMemo(function () {\n    return [FeeAmount.HIGH, FeeAmount.LOW, FeeAmount.LOWEST, FeeAmount.STABLE, FeeAmount.MEDIUM];\n  }, []);\n  var poolIds = useProAmmPoolInfos(currencyA, currencyB, feeAmounts);\n  var initState = useMemo(function () {\n    var _ref;\n\n    return _ref = {}, _defineProperty(_ref, FeeAmount.HIGH, 0), _defineProperty(_ref, FeeAmount.LOW, 0), _defineProperty(_ref, FeeAmount.LOWEST, 0), _defineProperty(_ref, FeeAmount.STABLE, 0), _defineProperty(_ref, FeeAmount.MEDIUM, 0), _ref;\n  }, []);\n\n  var _useState = useState(initState),\n      _useState2 = _slicedToArray(_useState, 2),\n      feeTierDistribution = _useState2[0],\n      setFeeTierDistribution = _useState2[1]; // reset feeTierDistribution when change token\n\n\n  useEffect(function () {\n    setFeeTierDistribution(initState);\n  }, [currencyA, currencyB, initState]);\n  useEffect(function () {\n    if (!chainId) return;\n    NETWORKS_INFO[chainId].elasticClient.query({\n      query: POOL_POSITION_COUNT(poolIds)\n    }).then(function (res) {\n      var _res$data, _res$data$pools;\n\n      var feeArray = res === null || res === void 0 ? void 0 : (_res$data = res.data) === null || _res$data === void 0 ? void 0 : (_res$data$pools = _res$data.pools) === null || _res$data$pools === void 0 ? void 0 : _res$data$pools.map(function (item) {\n        var activePositions = Number(item.positionCount) - Number(item.closedPostionCount);\n        return {\n          feeTier: item.feeTier,\n          activePositions: activePositions\n        };\n      });\n      var totalPostions = feeArray.reduce(function (total, cur) {\n        return total + cur.activePositions;\n      }, 0);\n      if (!totalPostions) return;\n      setFeeTierDistribution(Object.keys(FeeAmount).reduce(function (acc, cur) {\n        var temp = feeArray.find(function (item) {\n          return item.feeTier === cur;\n        });\n        return _objectSpread(_objectSpread({}, acc), {}, _defineProperty({}, cur, temp ? temp.activePositions * 100 / totalPostions : 0));\n      }, initState));\n    });\n  }, [chainId, initState, poolIds]);\n  return feeTierDistribution;\n};\n\n_s(useFeeTierDistribution, \"yKnv9zR0t5ZE6xo0Gimncz0oryQ=\", false, function () {\n  return [useActiveWeb3React, useProAmmPoolInfos];\n});","map":{"version":3,"names":["FeeAmount","useEffect","useMemo","useState","POOL_POSITION_COUNT","NETWORKS_INFO","useActiveWeb3React","useProAmmPoolInfos","useFeeTierDistribution","currencyA","currencyB","chainId","feeAmounts","HIGH","LOW","LOWEST","STABLE","MEDIUM","poolIds","initState","feeTierDistribution","setFeeTierDistribution","elasticClient","query","then","res","feeArray","data","pools","map","item","activePositions","Number","positionCount","closedPostionCount","feeTier","totalPostions","reduce","total","cur","Object","keys","acc","temp","find"],"sources":["/Applications/XAMPP/voxel-interface/src/components/FeeSelector/hook.ts"],"sourcesContent":["import { Currency } from '@kyberswap/ks-sdk-core'\nimport { FeeAmount } from '@kyberswap/ks-sdk-elastic'\nimport { useEffect, useMemo, useState } from 'react'\n\nimport { POOL_POSITION_COUNT } from 'apollo/queries/promm'\nimport { NETWORKS_INFO } from 'constants/networks'\nimport { useActiveWeb3React } from 'hooks'\nimport { useProAmmPoolInfos } from 'hooks/useProAmmPoolInfo'\n\nexport const useFeeTierDistribution = (\n  currencyA: Currency | undefined,\n  currencyB: Currency | undefined,\n): { [key in FeeAmount]: number } => {\n  const { chainId } = useActiveWeb3React()\n\n  const feeAmounts = useMemo(() => {\n    return [FeeAmount.HIGH, FeeAmount.LOW, FeeAmount.LOWEST, FeeAmount.STABLE, FeeAmount.MEDIUM]\n  }, [])\n\n  const poolIds = useProAmmPoolInfos(currencyA, currencyB, feeAmounts)\n\n  const initState = useMemo(() => {\n    return {\n      [FeeAmount.HIGH]: 0,\n      [FeeAmount.LOW]: 0,\n      [FeeAmount.LOWEST]: 0,\n      [FeeAmount.STABLE]: 0,\n      [FeeAmount.MEDIUM]: 0,\n    }\n  }, [])\n\n  const [feeTierDistribution, setFeeTierDistribution] = useState<{ [key in FeeAmount]: number }>(initState)\n\n  // reset feeTierDistribution when change token\n  useEffect(() => {\n    setFeeTierDistribution(initState)\n  }, [currencyA, currencyB, initState])\n\n  useEffect(() => {\n    if (!chainId) return\n    NETWORKS_INFO[chainId].elasticClient\n      .query({\n        query: POOL_POSITION_COUNT(poolIds),\n      })\n      .then(res => {\n        const feeArray: { feeTier: string; activePositions: number }[] = res?.data?.pools?.map(\n          (item: { positionCount: string; closedPostionCount: string; feeTier: string }) => {\n            const activePositions = Number(item.positionCount) - Number(item.closedPostionCount)\n            return {\n              feeTier: item.feeTier,\n              activePositions,\n            }\n          },\n        )\n\n        const totalPostions = feeArray.reduce((total, cur) => total + cur.activePositions, 0)\n\n        if (!totalPostions) return\n        setFeeTierDistribution(\n          Object.keys(FeeAmount).reduce((acc, cur) => {\n            const temp = feeArray.find(item => item.feeTier === cur)\n            return {\n              ...acc,\n              [cur]: temp ? (temp.activePositions * 100) / totalPostions : 0,\n            }\n          }, initState),\n        )\n      })\n  }, [chainId, initState, poolIds])\n\n  return feeTierDistribution\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}