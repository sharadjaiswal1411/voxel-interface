{"ast":null,"code":"import _regeneratorRuntime from \"/Applications/XAMPP/voxel-interface/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Applications/XAMPP/voxel-interface/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _defineProperty from \"/Applications/XAMPP/voxel-interface/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\n\nvar _s = $RefreshSig$();\n\nimport useSWR from 'swr';\nimport { NETWORKS_INFO } from 'constants/networks';\nimport { useActiveWeb3React } from 'hooks';\nimport { useETHPrice } from 'state/application/hooks';\nexport var GasLevel;\n\n(function (GasLevel) {\n  GasLevel[\"SLOW\"] = \"slow\";\n  GasLevel[\"NORMAL\"] = \"normal\";\n  GasLevel[\"FAST\"] = \"fast\";\n})(GasLevel || (GasLevel = {}));\n\nvar calculateGasPrices = function calculateGasPrices(resp, currentPrice) {\n  var _ref;\n\n  var levels = [GasLevel.SLOW, GasLevel.NORMAL, GasLevel.FAST];\n  var gasPricesInWei = levels.map(function (level) {\n    var _resp$find;\n\n    return (_resp$find = resp.find(function (item) {\n      return item.level === level;\n    })) === null || _resp$find === void 0 ? void 0 : _resp$find.price;\n  });\n  var gasPricesInGwei = gasPricesInWei.map(function (price) {\n    return price ? price / 1e9 : undefined;\n  });\n  var parsedCurrentPrice = currentPrice ? Number.parseFloat(String(currentPrice)) : NaN;\n  var costs = gasPricesInWei.map(function (gasPrice) {\n    if (!gasPrice || Number.isNaN(parsedCurrentPrice)) {\n      return '';\n    } // 190_000 is the minimum gas units needed for a swap\n\n\n    var cost = (gasPrice / 1e18 * parsedCurrentPrice * 190000).toFixed(2);\n    return cost;\n  });\n  return _ref = {}, _defineProperty(_ref, GasLevel.SLOW, {\n    gasPriceInGwei: gasPricesInGwei[0],\n    minimumTxFeeInUSD: costs[0]\n  }), _defineProperty(_ref, GasLevel.NORMAL, {\n    gasPriceInGwei: gasPricesInGwei[1],\n    minimumTxFeeInUSD: costs[1]\n  }), _defineProperty(_ref, GasLevel.FAST, {\n    gasPriceInGwei: gasPricesInGwei[2],\n    minimumTxFeeInUSD: costs[2]\n  }), _ref;\n};\n\nvar useGasPriceFromDeBank = function useGasPriceFromDeBank() {\n  _s();\n\n  var _useActiveWeb3React = useActiveWeb3React(),\n      chainId = _useActiveWeb3React.chainId;\n\n  var nativeTokenPriceData = useETHPrice();\n  var chainSlug = chainId ? NETWORKS_INFO[chainId].deBankSlug : '';\n\n  var _useSWR = useSWR(\"https://openapi.debank.com/v1/wallet/gas_market?chain_id=\".concat(chainSlug), /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(url) {\n      var _err, response, _data, _err2, err;\n\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!(!chainId || !chainSlug)) {\n                _context.next = 4;\n                break;\n              }\n\n              _err = \"chain (\".concat(chainId, \") is not supported\");\n              console.error(_err);\n              throw _err;\n\n            case 4:\n              _context.next = 6;\n              return fetch(url);\n\n            case 6:\n              response = _context.sent;\n\n              if (!response.ok) {\n                _context.next = 16;\n                break;\n              }\n\n              _context.next = 10;\n              return response.json();\n\n            case 10:\n              _data = _context.sent;\n\n              if (!(_data && Array.isArray(_data))) {\n                _context.next = 13;\n                break;\n              }\n\n              return _context.abrupt(\"return\", _data);\n\n            case 13:\n              _err2 = \"invalid data in chain (\".concat(chainSlug, \")\");\n              console.error(_err2);\n              throw _err2;\n\n            case 16:\n              err = \"fetching data on chain (\".concat(chainSlug, \") failed\");\n              console.error(err);\n              throw err;\n\n            case 19:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function (_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }()),\n      data = _useSWR.data,\n      error = _useSWR.error;\n\n  if (error || !data) {\n    return undefined;\n  }\n\n  return calculateGasPrices(data, nativeTokenPriceData.currentPrice);\n};\n\n_s(useGasPriceFromDeBank, \"VgZsuRN9VNdPBYTOtSP66IGcD1A=\", false, function () {\n  return [useActiveWeb3React, useETHPrice, useSWR];\n});\n\nexport default useGasPriceFromDeBank;","map":{"version":3,"names":["useSWR","NETWORKS_INFO","useActiveWeb3React","useETHPrice","GasLevel","calculateGasPrices","resp","currentPrice","levels","SLOW","NORMAL","FAST","gasPricesInWei","map","level","find","item","price","gasPricesInGwei","undefined","parsedCurrentPrice","Number","parseFloat","String","NaN","costs","gasPrice","isNaN","cost","toFixed","gasPriceInGwei","minimumTxFeeInUSD","useGasPriceFromDeBank","chainId","nativeTokenPriceData","chainSlug","deBankSlug","url","err","console","error","fetch","response","ok","json","data","Array","isArray"],"sources":["/Applications/XAMPP/voxel-interface/src/hooks/useGasPriceFromDeBank.ts"],"sourcesContent":["import useSWR from 'swr'\n\nimport { NETWORKS_INFO } from 'constants/networks'\nimport { useActiveWeb3React } from 'hooks'\nimport { useETHPrice } from 'state/application/hooks'\n\nexport enum GasLevel {\n  SLOW = 'slow',\n  NORMAL = 'normal',\n  FAST = 'fast',\n}\n\ntype Response = Array<{\n  level: GasLevel\n  front_tx_count: number\n  price: number // in wei\n  estimated_seconds: number\n}>\n\ntype GasPriceTrackerData = Record<\n  GasLevel,\n  {\n    gasPriceInGwei?: number\n    minimumTxFeeInUSD?: string\n  }\n>\n\nconst calculateGasPrices = (resp: Response, currentPrice?: string | number): GasPriceTrackerData => {\n  const levels = [GasLevel.SLOW, GasLevel.NORMAL, GasLevel.FAST]\n\n  const gasPricesInWei = levels.map(level => resp.find(item => item.level === level)?.price)\n  const gasPricesInGwei = gasPricesInWei.map(price => (price ? price / 1e9 : undefined))\n\n  const parsedCurrentPrice = currentPrice ? Number.parseFloat(String(currentPrice)) : NaN\n\n  const costs = gasPricesInWei.map(gasPrice => {\n    if (!gasPrice || Number.isNaN(parsedCurrentPrice)) {\n      return ''\n    }\n    // 190_000 is the minimum gas units needed for a swap\n    const cost = ((gasPrice / 1e18) * parsedCurrentPrice * 190_000).toFixed(2)\n    return cost\n  })\n\n  return {\n    [GasLevel.SLOW]: {\n      gasPriceInGwei: gasPricesInGwei[0],\n      minimumTxFeeInUSD: costs[0],\n    },\n    [GasLevel.NORMAL]: {\n      gasPriceInGwei: gasPricesInGwei[1],\n      minimumTxFeeInUSD: costs[1],\n    },\n    [GasLevel.FAST]: {\n      gasPriceInGwei: gasPricesInGwei[2],\n      minimumTxFeeInUSD: costs[2],\n    },\n  }\n}\n\nconst useGasPriceFromDeBank = (): GasPriceTrackerData | undefined => {\n  const { chainId } = useActiveWeb3React()\n  const nativeTokenPriceData = useETHPrice()\n  const chainSlug = chainId ? NETWORKS_INFO[chainId].deBankSlug : ''\n  const { data, error } = useSWR<Response>(\n    `https://openapi.debank.com/v1/wallet/gas_market?chain_id=${chainSlug}`,\n    async (url: string) => {\n      if (!chainId || !chainSlug) {\n        const err = `chain (${chainId}) is not supported`\n        console.error(err)\n        throw err\n      }\n\n      const response = await fetch(url)\n      if (response.ok) {\n        const data = await response.json()\n        if (data && Array.isArray(data)) {\n          return data\n        }\n\n        const err = `invalid data in chain (${chainSlug})`\n        console.error(err)\n        throw err\n      }\n\n      const err = `fetching data on chain (${chainSlug}) failed`\n      console.error(err)\n      throw err\n    },\n  )\n\n  if (error || !data) {\n    return undefined\n  }\n\n  return calculateGasPrices(data, nativeTokenPriceData.currentPrice)\n}\n\nexport default useGasPriceFromDeBank\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}